{"version":3,"sources":["customer.controller.js"],"names":["Customer","require","request","bcrypt","auth","registerCustomer","req","res","customername","email","vehicleid","nic","phonenumber","vehicletype","pwd","salt","password","customer","regeneratorRuntime","async","_context","prev","next","body","genSaltSync","hashSync","awrap","save","sent","log","abrupt","message","status","send","t0","isJoined","stop","updateCustomerJoinedStatus","_context2","params","updateOne","$set","console","login","token","_context3","findOne","compareSync","generateAccessToken","_objectSpread","toJSON","updateTime","changeTime","_context4","findOneAndUpdate","getOneUser","_context5","json","module","exports"],"mappings":"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","file":"customer.controller.min.js","sourcesContent":["const Customer = require('../models/customer.model');\r\nconst { request } = require('express')\r\nconst bcrypt = require('bcryptjs');\r\nconst auth = require('../middlewares/token')\r\n\r\nconst registerCustomer = async (req, res) => {\r\n\r\n    const customername = req.body.customername;\r\n    const email = req.body.email;\r\n    const vehicleid = req.body.vehicleid;\r\n    const nic = req.body.nic;\r\n    const phonenumber = req.body.phonenumber;\r\n    const vehicletype = req.body.vehicletype;\r\n    const pwd = req.body.password;\r\n\r\n    const salt = bcrypt.genSaltSync(10);\r\n    const password = bcrypt.hashSync(pwd, salt);\r\n\r\n    const customer = new Customer({\r\n        customername,\r\n        email,\r\n        vehicleid,\r\n        nic,\r\n        phonenumber,\r\n        vehicletype,\r\n        password,\r\n        isJoined : false\r\n    })\r\n\r\n    try{\r\n        let response = await customer.save();\r\n        if(response) {\r\n            console.log(\"yes\")\r\n            return res.status(201).send({message: \"New Customer Registered to the Fuel System\"})\r\n        }else {\r\n            console.log(\"no\")\r\n            return res.status(500).send({message: \"Internal server error\"});\r\n        }\r\n    }catch (error) {\r\n        console.log(error);\r\n        return res.status(400).send({message: \"Error while registering the customer to the application\"})\r\n\r\n    }\r\n\r\n}\r\n\r\nconst updateCustomerJoinedStatus = async (req, res) => {\r\n\r\n    const email = req.params.email;\r\n\r\n    try {\r\n        const response = await Customer.updateOne(\r\n            {\"email\": email},\r\n            {$set: {\"isJoined\": true }}\r\n        )\r\n        if(response){\r\n            console.log(\"Ok\")\r\n            return res.status(200).send({ message: true })\r\n        }\r\n    } catch (err) {\r\n        console.log(\"error while updating user>>\")\r\n        return res.status(500).send({ message: 'Internal server error' })\r\n    }\r\n}\r\n\r\nconst login = async (req, res) => {\r\n    const email = req.body.email;\r\n    const password = req.body.password;\r\n\r\n    try {\r\n        const customer = await Customer.findOne({ email: email });\r\n        if (customer) {\r\n            if (customer && bcrypt.compareSync(password, customer.password)) {\r\n                const token = auth.generateAccessToken(email);\r\n                \r\n                return res.status(200).send({ ...customer.toJSON(), token  });\r\n            }\r\n            else {\r\n                return res.status(400).send({ message: 'Such user does not exist check your credentials' })\r\n            }\r\n        } else {\r\n            return res.status(404).send({ message: 'Such user does not exist' });\r\n        }\r\n    } catch (err) {\r\n        return res.status(400).send({ message: 'Such user does not exist check your credentials' })\r\n    }\r\n\r\n}\r\n\r\nconst updateTime = async (req, res) => {\r\n    const vehicleid = req.params.vehicleid;\r\n\r\n    const customer = await Customer.findOne({ vehicleid: vehicleid });\r\n\r\n    const password = customer.password;\r\n\r\n    const changeTime = {\r\n        customername : req.body.customername,\r\n        vehicleid : req.body.vehicleid,\r\n        nic : req.body.nic,\r\n        phonenumber : req.body.phonenumber,\r\n        vehicletype : req.body.vehicletype,\r\n        password : password\r\n    }\r\n\r\n    try {\r\n        const response = await Customer.findOneAndUpdate({ vehicleid: vehicleid } , changeTime);\r\n        if(response){\r\n            return res.status(200).send({message: 'Successfully update time'})\r\n        }else {\r\n\r\n        return res.status(500).send({ message: 'Internal server error' });\r\n        }\r\n\r\n    } catch (err) {\r\n        return res.status(400).send({ message: 'Unable to update' })\r\n    }\r\n}\r\n\r\n\r\nconst getOneUser = async (req, res) => {\r\n\r\n    const email = req.params.email;\r\n\r\n    try {\r\n        let customer = await Customer.findOne({\r\n            email: email \r\n        });\r\n        if(customer) {\r\n            return res.json(customer)\r\n        }else {\r\n            return res.status(404).send({ message: 'No such customer found' });\r\n        }\r\n    } catch (err) {\r\n        return res.status(500).send({ message: 'Internal Server Error' })\r\n    }\r\n}\r\n\r\n\r\n\r\nmodule.exports = {\r\n    registerCustomer,\r\n    login,\r\n    updateTime,\r\n    getOneUser,\r\n    updateCustomerJoinedStatus\r\n}"]}