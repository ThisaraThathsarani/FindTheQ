"use strict";function ownKeys(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(r,!0).forEach(function(e){_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(r).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Station=require("../models/stationOwner.model"),_require=require("express"),request=_require.request,bcrypt=require("bcryptjs"),auth=require("../middlewares/token"),registerStation=function(t,r){var n,a,s,u,o,i,c,p,d,b,l,m;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body.stationid,a=t.body.ownername,s=t.body.stationname,u=t.body.phonenumber,o=t.body.address,i=t.body.arrivaltime,c=t.body.finishtime,p=t.body.fueltype,d=t.body.password,b=bcrypt.genSaltSync(10),l=bcrypt.hashSync(d,b),m=new Station({stationid:n,ownername:a,stationname:s,phonenumber:u,address:o,arrivaltime:i,finishtime:c,fueltype:p,password:l}),e.prev=12,e.next=15,regeneratorRuntime.awrap(m.save());case 15:if(e.sent)return e.abrupt("return",r.status(201).send({message:"New Station Registered to the Fuel System"}));e.next=20;break;case 20:return e.abrupt("return",r.status(500).send({message:"Internal server error"}));case 21:e.next=27;break;case 23:return e.prev=23,e.t0=e.catch(12),console.log(e.t0),e.abrupt("return",r.status(400).send({message:"Error while registering the station to the application"}));case 27:case"end":return e.stop()}},null,null,[[12,23]])},login=function(t,r){var n,a,s,u;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body.ownername,a=t.body.password,e.prev=2,e.next=5,regeneratorRuntime.awrap(Station.findOne({ownername:n}));case 5:if(!(s=e.sent)){e.next=15;break}if(s&&bcrypt.compareSync(a,s.password))return u=auth.generateAccessToken(n),e.abrupt("return",r.status(200).send(_objectSpread({},n.toJSON(),{token:u})));e.next=12;break;case 12:return e.abrupt("return",r.status(400).send({message:"Such user does not exist check your credentials"}));case 13:e.next=16;break;case 15:return e.abrupt("return",r.status(404).send({message:"Such user does not exist"}));case 16:e.next=21;break;case 18:return e.prev=18,e.t0=e.catch(2),e.abrupt("return",r.status(400).send({message:"Such user does not exist check your credentials"}));case 21:case"end":return e.stop()}},null,null,[[2,18]])},getAllStation=function(e,t){var r;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(Station.find());case 3:if(r=e.sent)return e.abrupt("return",t.json(r));e.next=8;break;case 8:return e.abrupt("return",t.status(404).send({message:"Error on retrieving station"}));case 9:e.next=14;break;case 11:return e.prev=11,e.t0=e.catch(0),e.abrupt("return",t.status(500).send({message:"Internal server error"}));case 14:case"end":return e.stop()}},null,null,[[0,11]])},getOneStation=function(t,r){var n,a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.id,e.prev=1,e.next=4,regeneratorRuntime.awrap(Station.findOne({stationID:n}));case 4:if(a=e.sent)return e.abrupt("return",r.json(a));e.next=9;break;case 9:return e.abrupt("return",r.status(404).send({message:"No such station found"}));case 10:e.next=15;break;case 12:return e.prev=12,e.t0=e.catch(1),e.abrupt("return",r.status(500).send({message:"Internal Server Error"}));case 15:case"end":return e.stop()}},null,null,[[1,12]])},searchStation=function(t,r){var n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.stationname.trim(),e.prev=1,e.next=4,regeneratorRuntime.awrap(Station.find());case 4:if(!e.sent){e.next=9;break}Station.find({stationname:{$regex:"^"+n+".*",$options:"i"}}).then(function(e){r.json(e)}),e.next=10;break;case 9:return e.abrupt("return",r.status(404).send({message:"No such station found"}));case 10:e.next=15;break;case 12:return e.prev=12,e.t0=e.catch(1),e.abrupt("return",r.status(500).send({message:"Internal Server Error"}));case 15:case"end":return e.stop()}},null,null,[[1,12]])},updateTime=function(t,r){var n,a,s,u,o,i,c;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.stationid,e.next=3,regeneratorRuntime.awrap(Station.findOne({stationid:n}));case 3:return a=e.sent,s=a.ownername,u=a.stationname,o=a.address,i=a.phonenumber,c={stationid:n,ownername:s,stationname:u,phonenumber:i,address:o,arrivaltime:t.body.arrivaltime,finishtime:t.body.finishtime,fueltype:t.body.fueltype},e.prev=9,e.next=12,regeneratorRuntime.awrap(Station.findOneAndUpdate({stationid:n},c));case 12:if(e.sent)return e.abrupt("return",r.status(200).send({message:"Successfully updated"}));e.next=17;break;case 17:return e.abrupt("return",r.status(500).send({message:"Internal server error"}));case 18:e.next=23;break;case 20:return e.prev=20,e.t0=e.catch(9),e.abrupt("return",r.status(400).send({message:"Unable to update"}));case 23:case"end":return e.stop()}},null,null,[[9,20]])};module.exports={registerStation:registerStation,getAllStation:getAllStation,getOneStation:getOneStation,searchStation:searchStation,updateTime:updateTime,login:login};
//# sourceMappingURL=stationOwner.controller.min.js.map
