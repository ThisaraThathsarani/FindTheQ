"use strict";function ownKeys(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(r,!0).forEach(function(e){_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(r).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var FuelStation=require("../models/station.model"),_require=require("express"),request=_require.request,bcrypt=require("bcryptjs"),auth=require("../middlewares/token"),StationRegister=function(t,r){var n,a,s,u,o,i,c,d,p,l,m,b,f,g;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body.id,a=t.body.name,s=t.body.ownername,u=t.body.phonenumber,o=t.body.address,i=t.body.arrivaltime,c=t.body.finishtime,d=t.body.status,p=t.body.stock,l=t.body.queue,m=t.body.password,b=bcrypt.genSaltSync(10),f=bcrypt.hashSync(m,b),g=new FuelStation({id:n,name:a,ownername:s,phonenumber:u,address:o,arrivaltime:i,finishtime:c,status:d,stock:p,queue:l,password:f}),e.prev=14,e.next=17,regeneratorRuntime.awrap(g.save());case 17:if(e.sent)return e.abrupt("return",r.status(201).send({message:"New Station Registered to the Fuel System"}));e.next=22;break;case 22:return e.abrupt("return",r.status(500).send({message:"Internal server error"}));case 23:e.next=29;break;case 25:return e.prev=25,e.t0=e.catch(14),console.log(e.t0),e.abrupt("return",r.status(400).send({message:"Error while registering the station to the application"}));case 29:case"end":return e.stop()}},null,null,[[14,25]])},login=function(t,r){var n,a,s,u;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body.stationid,a=t.body.password,e.prev=2,e.next=5,regeneratorRuntime.awrap(FuelStation.findOne({stationid:n}));case 5:if(!(s=e.sent)){e.next=15;break}if(s&&bcrypt.compareSync(a,s.password))return u=auth.generateAccessToken(n),e.abrupt("return",r.status(200).send(_objectSpread({},customer.toJSON(),{token:u})));e.next=12;break;case 12:return e.abrupt("return",r.status(400).send({message:"Such user does not exist check your credentials"}));case 13:e.next=16;break;case 15:return e.abrupt("return",r.status(404).send({message:"Such user does not exist"}));case 16:e.next=21;break;case 18:return e.prev=18,e.t0=e.catch(2),e.abrupt("return",r.status(400).send({message:"Such user does not exist check your credentials"}));case 21:case"end":return e.stop()}},null,null,[[2,18]])},getAllFuelStation=function(e,t){var r;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(FuelStation.find());case 3:if(r=e.sent)return e.abrupt("return",t.json(r));e.next=8;break;case 8:return e.abrupt("return",t.status(404).send({message:"Error on retrieving station"}));case 9:e.next=14;break;case 11:return e.prev=11,e.t0=e.catch(0),e.abrupt("return",t.status(500).send({message:"Internal server error"}));case 14:case"end":return e.stop()}},null,null,[[0,11]])},getOneFuelStation=function(t,r){var n,a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.id,e.prev=1,e.next=4,regeneratorRuntime.awrap(FuelStation.findOne({stationid:n}));case 4:if(a=e.sent)return e.abrupt("return",r.json(a));e.next=9;break;case 9:return e.abrupt("return",r.status(404).send({message:"No such station found"}));case 10:e.next=15;break;case 12:return e.prev=12,e.t0=e.catch(1),e.abrupt("return",r.status(500).send({message:"Internal Server Error"}));case 15:case"end":return e.stop()}},null,null,[[1,12]])},searchStation=function(t,r){var n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.name.trim(),e.prev=1,e.next=4,regeneratorRuntime.awrap(FuelStation.find());case 4:if(!e.sent){e.next=9;break}FuelStation.find({name:{$regex:"^"+n+".*",$options:"i"}}).then(function(e){r.json(e)}),e.next=10;break;case 9:return e.abrupt("return",r.status(404).send({message:"No such station found"}));case 10:e.next=15;break;case 12:return e.prev=12,e.t0=e.catch(1),e.abrupt("return",r.status(500).send({message:"Internal Server Error"}));case 15:case"end":return e.stop()}},null,null,[[1,12]])},searchByAddress=function(t,r){var n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.address.trim(),e.prev=1,e.next=4,regeneratorRuntime.awrap(FuelStation.find());case 4:if(!e.sent){e.next=9;break}FuelStation.find({address:{$regex:"^"+n+".*",$options:"i"}}).then(function(e){r.json(e)}),e.next=10;break;case 9:return e.abrupt("return",r.status(404).send({message:"No such station found"}));case 10:e.next=15;break;case 12:return e.prev=12,e.t0=e.catch(1),e.abrupt("return",r.status(500).send({message:"Internal Server Error"}));case 15:case"end":return e.stop()}},null,null,[[1,12]])},updateStatus=function(t,r){var n,a,s,u,o,i,c,d,p,l,m;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.id,e.next=3,regeneratorRuntime.awrap(FuelStation.findOne({stationid:n}));case 3:return a=e.sent,s=a.name,u=a.ownername,o=a.phonenumber,i=a.address,c=a.arrivaltime,d=a.finishtime,p=a.stock,l=a.queue,m={id:n,name:s,ownername:u,phonenumber:o,address:i,arrivaltime:c,finishtime:d,status:t.body.status,stock:p,queue:l},e.prev=13,e.next=16,regeneratorRuntime.awrap(FuelStation.findOneAndUpdate({stationid:n},m));case 16:if(e.sent)return e.abrupt("return",r.status(200).send({message:"Successfully updated"}));e.next=21;break;case 21:return e.abrupt("return",r.status(500).send({message:"Internal server error"}));case 22:e.next=27;break;case 24:return e.prev=24,e.t0=e.catch(13),e.abrupt("return",r.status(400).send({message:"Unable to update"}));case 27:case"end":return e.stop()}},null,null,[[13,24]])},updatestock=function(t,r){var n,a,s,u,o,i,c,d,p,l,m;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.id,e.next=3,regeneratorRuntime.awrap(FuelStation.findOne({id:n}));case 3:return a=e.sent,s=a.name,u=a.ownername,o=a.phonenumber,i=a.address,c=a.arrivaltime,d=a.finishtime,p=a.status,l=a.queue,m={id:n,name:s,ownername:u,phonenumber:o,address:i,arrivaltime:c,finishtime:d,status:p,stock:t.body.stock,queue:l},e.prev=13,e.next=16,regeneratorRuntime.awrap(FuelStation.findOneAndUpdate({stationid:n},m));case 16:if(e.sent)return e.abrupt("return",r.status(200).send({message:"Successfully updated"}));e.next=21;break;case 21:return e.abrupt("return",r.status(500).send({message:"Internal server error"}));case 22:e.next=27;break;case 24:return e.prev=24,e.t0=e.catch(13),e.abrupt("return",r.status(400).send({message:"Unable to update"}));case 27:case"end":return e.stop()}},null,null,[[13,24]])},updatelength=function(t,r){var n,a,s,u,o,i,c,d,p,l,m;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.id,e.next=3,regeneratorRuntime.awrap(FuelStation.findOne({id:n}));case 3:return a=e.sent,s=a.name,u=a.ownername,o=a.phonenumber,i=a.address,c=a.arrivaltime,d=a.finishtime,p=a.status,l=a.stock,m={id:n,name:s,ownername:u,phonenumber:o,address:i,arrivaltime:c,finishtime:d,status:p,stock:l,queue:t.body.queue},e.prev=13,e.next=16,regeneratorRuntime.awrap(FuelStation.findOneAndUpdate({id:n},m));case 16:if(e.sent)return e.abrupt("return",r.status(200).send({message:"Successfully updated"}));e.next=21;break;case 21:return e.abrupt("return",r.status(500).send({message:"Internal server error"}));case 22:e.next=27;break;case 24:return e.prev=24,e.t0=e.catch(13),e.abrupt("return",r.status(400).send({message:"Unable to update"}));case 27:case"end":return e.stop()}},null,null,[[13,24]])},updateDetails=function(t,r){var n,a,s,u,o,i,c,d,p,l;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.id,e.next=3,regeneratorRuntime.awrap(FuelStation.findOne({id:n}));case 3:return a=e.sent,s=a.name,u=a.ownername,o=a.phonenumber,i=a.address,c=a.arrivaltime,d=a.finishtime,p=a.queue,l={id:n,name:s,ownername:u,phonenumber:o,address:i,arrivaltime:c,finishtime:d,status:t.body.status,stock:t.body.stock,queue:p},e.prev=12,e.next=15,regeneratorRuntime.awrap(FuelStation.findOneAndUpdate({id:n},l));case 15:if(e.sent)return e.abrupt("return",r.status(200).send({message:"Successfully updated"}));e.next=20;break;case 20:return e.abrupt("return",r.status(500).send({message:"Internal server error"}));case 21:e.next=26;break;case 23:return e.prev=23,e.t0=e.catch(12),e.abrupt("return",r.status(400).send({message:"Unable to update"}));case 26:case"end":return e.stop()}},null,null,[[12,23]])},getcount=function(t,r){var n,a,s,u,o,i,c,d;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.id.trim(),console.log("carcount"),e.prev=2,e.next=5,regeneratorRuntime.awrap(FuelStation.findOne({id:n}));case 5:if(a=e.sent)return s=a.queue.Car,u=a.queue.Van,o=a.queue.Bus,i=a.queue.Bike,c=a.queue.Tuk,d=s+u+o+i+c,e.abrupt("return",r.status(200).send({count:d}));e.next=16;break;case 16:return e.abrupt("return",r.status(404).send({message:"No such vehicle type found"}));case 17:e.next=22;break;case 19:return e.prev=19,e.t0=e.catch(2),e.abrupt("return",r.status(500).send({message:"Internal Server Error"}));case 22:case"end":return e.stop()}},null,null,[[2,19]])},getCarCount=function(t,r){var n,a,s;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.id.trim(),e.prev=1,e.next=4,regeneratorRuntime.awrap(FuelStation.findOne({id:n}));case 4:if(a=e.sent)return s=a.queue.Car,e.abrupt("return",r.status(200).send({count:s}));e.next=10;break;case 10:return e.abrupt("return",r.status(404).send({message:"No such vehicle type found"}));case 11:e.next=16;break;case 13:return e.prev=13,e.t0=e.catch(1),e.abrupt("return",r.status(500).send({message:"Internal Server Error"}));case 16:case"end":return e.stop()}},null,null,[[1,13]])},getVanCount=function(t,r){var n,a,s;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.id.trim(),e.prev=1,e.next=4,regeneratorRuntime.awrap(FuelStation.findOne({id:n}));case 4:if(a=e.sent)return s=a.queue.Van,e.abrupt("return",r.status(200).send({count:s}));e.next=10;break;case 10:return e.abrupt("return",r.status(404).send({message:"No such vehicle type found"}));case 11:e.next=16;break;case 13:return e.prev=13,e.t0=e.catch(1),e.abrupt("return",r.status(500).send({message:"Internal Server Error"}));case 16:case"end":return e.stop()}},null,null,[[1,13]])},getBusCount=function(t,r){var n,a,s;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.id.trim(),e.prev=1,e.next=4,regeneratorRuntime.awrap(FuelStation.findOne({id:n}));case 4:if(a=e.sent)return s=a.queue.Bus,e.abrupt("return",r.status(200).send({count:s}));e.next=10;break;case 10:return e.abrupt("return",r.status(404).send({message:"No such vehicle type found"}));case 11:e.next=16;break;case 13:return e.prev=13,e.t0=e.catch(1),e.abrupt("return",r.status(500).send({message:"Internal Server Error"}));case 16:case"end":return e.stop()}},null,null,[[1,13]])},getBikeCount=function(t,r){var n,a,s;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.id.trim(),e.prev=1,e.next=4,regeneratorRuntime.awrap(FuelStation.findOne({id:n}));case 4:if(a=e.sent)return s=a.queue.Bike,e.abrupt("return",r.status(200).send({count:s}));e.next=10;break;case 10:return e.abrupt("return",r.status(404).send({message:"No such vehicle type found"}));case 11:e.next=16;break;case 13:return e.prev=13,e.t0=e.catch(1),e.abrupt("return",r.status(500).send({message:"Internal Server Error"}));case 16:case"end":return e.stop()}},null,null,[[1,13]])},getTukCount=function(t,r){var n,a,s;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.id.trim(),e.prev=1,e.next=4,regeneratorRuntime.awrap(FuelStation.findOne({id:n}));case 4:if(a=e.sent)return s=a.queue.Tuk,e.abrupt("return",r.status(200).send({count:s}));e.next=10;break;case 10:return e.abrupt("return",r.status(404).send({message:"No such vehicle type found"}));case 11:e.next=16;break;case 13:return e.prev=13,e.t0=e.catch(1),e.abrupt("return",r.status(500).send({message:"Internal Server Error"}));case 16:case"end":return e.stop()}},null,null,[[1,13]])};module.exports={StationRegister:StationRegister,getAllFuelStation:getAllFuelStation,getOneFuelStation:getOneFuelStation,searchStation:searchStation,searchByAddress:searchByAddress,updateStatus:updateStatus,updatestock:updatestock,updatelength:updatelength,updateDetails:updateDetails,getcount:getcount,getCarCount:getCarCount,getVanCount:getVanCount,getBusCount:getBusCount,getBikeCount:getBikeCount,getTukCount:getTukCount,login:login};
//# sourceMappingURL=station.controller.min.js.map
